{% extends 'main/layoutMain.html' %}

{% block title %}–í—Ö–æ–¥ - –ê–≤—Ç–æ—à–∫–æ–ª–∞ –û–Ω–ª–∞–π–Ω{% endblock %}

{% block content %}
    <h1 class="text-center">üîê –í—Ö–æ–¥</h1>
    <div class="row justify-content-center">
        <div class="col-md-4">
            <form method="post" id="loginForm">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="username" class="form-label">–í–≤–µ–¥–∏—Ç–µ –ø–æ—á—Ç—É</label>
                    <input type="text" name="username" id="username" class="form-control" required autocomplete="username">
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" name="password" id="password" class="form-control" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-dark w-100" id="submitBtn">–í–æ–π—Ç–∏</button>
            </form>

            <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-danger mt-3">{{ message }}</div>
                {% endfor %}
            {% endif %}

            <div class="mt-3 text-center">
                <p><a href="{% url 'password_reset_request' %}" class="text-danger">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a></p>
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="{% url 'register' %}">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('loginForm');
            const submitBtn = document.getElementById('submitBtn');
            let lockoutTime = {{ lockout_time|default:0 }};

            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            form.reset();

            // –¢–∞–π–º–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            function updateTimer() {
                if (lockoutTime > 0) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = `–ü–æ–¥–æ–∂–¥–∏—Ç–µ ${lockoutTime} —Å–µ–∫`;
                    lockoutTime--;
                    setTimeout(updateTimer, 1000);
                } else {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "–í–æ–π—Ç–∏";
                }
            }

            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞, –µ—Å–ª–∏ –µ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
            if (lockoutTime > 0) {
                updateTimer();
            }

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            form.addEventListener('submit', function() {
                submitBtn.disabled = true;

            });
        });
    </script>
{% endblock %}